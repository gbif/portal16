/* eslint-disable object-curly-spacing */
/*
Similate approximate load on services for the new demo site when visiting a dataset page.
*/
const { graphqlRequest, replaceKeyInVariables } = require('./graphqlRequest');

const exampleKey = '38b4c89f-584c-41bb-bd8f-cd1def33e92f';

function datasetKeyLoad(datasetKey) {
  graphqlRequest(queries.details.query, { key: datasetKey });
  graphqlRequest(queries.publishingCountries.query, replaceKeyInVariables(queries.stats.variables, exampleKey, datasetKey));
  graphqlRequest(queries.insights.query, replaceKeyInVariables(queries.stats.variables, exampleKey, datasetKey));
  graphqlRequest(queries.stats.query, replaceKeyInVariables(queries.stats.variables, exampleKey, datasetKey));
}

const queries = {
  details: { 'query': '\n  query Dataset($key: ID!) {\n    literatureSearch(gbifDatasetKey: [$key]) {\n      documents {\n        total\n      }\n    }\n    totalTaxa: taxonSearch(datasetKey: [$key], origin: [SOURCE]) {\n      count\n    }\n    accepted: taxonSearch(datasetKey: [$key], origin: [SOURCE], status: [ACCEPTED]) {\n      count\n    }\n    synonyms: taxonSearch(\n      datasetKey: [$key]\n      origin: [SOURCE]\n      status: [SYNONYM, HETEROTYPIC_SYNONYM, PROPARTE_SYNONYM, HOMOTYPIC_SYNONYM]\n    ) {\n      count\n    }\n    dataset(key: $key) {\n      key\n      checklistBankDataset {\n        key\n      }\n      type\n      title\n      created\n      modified\n      deleted\n      duplicateOfDataset {\n        key\n        title\n      }\n      metrics {\n        colCoveragePct\n        nubCoveragePct\n        nubMatchingCount\n        colMatchingCount\n      }\n      pubDate\n      description\n      purpose\n      temporalCoverages\n      logoUrl\n      publishingOrganizationKey\n      publishingOrganizationTitle\n      homepage\n      additionalInfo\n      installation {\n        key\n        title\n        organization {\n          key\n          title\n        }\n      }\n      volatileContributors {\n        key\n        firstName\n        lastName\n        position\n        organization\n        address\n        userId\n        email\n        phone\n        type\n        _highlighted\n        roles\n      }\n      contactsCitation {\n        key\n        abbreviatedName\n        firstName\n        lastName\n        userId\n        roles\n      }\n      geographicCoverages {\n        description\n        boundingBox {\n          minLatitude\n          maxLatitude\n          minLongitude\n          maxLongitude\n          globalCoverage\n        }\n      }\n      taxonomicCoverages {\n        description\n        coverages {\n          scientificName\n          commonName\n          rank {\n            interpreted\n          }\n        }\n      }\n      publishingOrganization {\n        title\n        homepage\n        logoUrl\n      }\n      bibliographicCitations {\n        identifier\n        text\n      }\n      samplingDescription {\n        studyExtent\n        sampling\n        qualityControl\n        methodSteps\n      }\n      dataDescriptions {\n        charset\n        name\n        format\n        formatVersion\n        url\n      }\n      keywordCollections {\n        thesaurus\n        keywords\n      }\n      citation {\n        text\n      }\n      license\n      project {\n        title\n        abstract\n        studyAreaDescription\n        designDescription\n        funding\n        contacts {\n          firstName\n          lastName\n\n          organization\n          position\n          roles\n          type\n\n          address\n          city\n          postalCode\n          province\n          country\n\n          homepage\n          email\n          phone\n          userId\n        }\n        identifier\n        gbifProject {\n          title\n          primaryImage {\n            ...ArticleBanner\n          }\n        }\n      }\n      endpoints {\n        key\n        type\n        url\n      }\n      identifiers(limit: 50) {\n        key\n        type\n        identifier\n      }\n      doi\n      machineTags {\n        namespace\n        name\n        value\n      }\n      localContexts {\n        project_page\n        title\n        description\n        notes {\n          name\n          img_url\n          description\n          pageUrl\n        }\n      }\n      gridded {\n        percent\n      }\n    }\n  }\n\n  fragment ArticleBanner on AssetImage {\n    description\n    title\n    file {\n      url\n      details {\n        image {\n          width\n          height\n        }\n      }\n      normal: thumbor(width: 1200, height: 500)\n      mobile: thumbor(width: 800, height: 400)\n    }\n  }\n', 'variables': { 'key': '38b4c89f-584c-41bb-bd8f-cd1def33e92f' }, 'operationName': 'Dataset' },
  publishingCountries: { 'query': '\n  query datasetPublishingCountries($sitePredicate: Predicate) {\n    occurrenceSearch(predicate: $sitePredicate) {\n      facet {\n        countryCode(size: 500) {\n          key\n          count\n        }\n      }\n    }\n  }\n', 'variables': { 'sitePredicate': { 'type': 'and', 'predicates': [{ 'type': 'equals', 'key': 'DATASET_KEY', 'value': '38b4c89f-584c-41bb-bd8f-cd1def33e92f' }] } }, 'operationName': 'datasetPublishingCountries' },
  insights: { 'query': '\n  query DatasetInsights(\n    $datasetPredicate: Predicate\n    $imagePredicate: Predicate\n    $coordinatePredicate: Predicate\n    $taxonPredicate: Predicate\n    $eventDatePredicate: Predicate\n    $eventPredicate: Predicate\n    $sitePredicate: Predicate\n  ) {\n    unfiltered: occurrenceSearch(predicate: $datasetPredicate) {\n      documents(size: 0) {\n        total\n      }\n    }\n    siteOccurrences: occurrenceSearch(predicate: $sitePredicate) {\n      documents(size: 0) {\n        total\n      }\n      cardinality {\n        eventId\n      }\n      facet {\n        dwcaExtension {\n          key\n          count\n        }\n      }\n    }\n    images: occurrenceSearch(predicate: $imagePredicate) {\n      documents(size: 10) {\n        total\n        results {\n          key\n          stillImages {\n            identifier: thumbor(height: 400)\n          }\n        }\n      }\n    }\n    withCoordinates: occurrenceSearch(predicate: $coordinatePredicate) {\n      documents(size: 10) {\n        total\n      }\n    }\n    withTaxonMatch: occurrenceSearch(predicate: $taxonPredicate) {\n      documents(size: 10) {\n        total\n      }\n    }\n    withEventDate: occurrenceSearch(predicate: $eventDatePredicate) {\n      documents(size: 10) {\n        total\n      }\n    }\n    withEventId: occurrenceSearch(predicate: $eventPredicate) {\n      documents(size: 10) {\n        total\n      }\n    }\n  }\n', 'variables': { 'sitePredicate': { 'type': 'and', 'predicates': [{ 'type': 'equals', 'key': 'datasetKey', 'value': '38b4c89f-584c-41bb-bd8f-cd1def33e92f' }] }, 'datasetPredicate': { 'type': 'equals', 'key': 'datasetKey', 'value': '38b4c89f-584c-41bb-bd8f-cd1def33e92f' }, 'imagePredicate': { 'type': 'and', 'predicates': [{ 'type': 'equals', 'key': 'datasetKey', 'value': '38b4c89f-584c-41bb-bd8f-cd1def33e92f' }, { 'type': 'equals', 'key': 'mediaType', 'value': 'StillImage' }] }, 'coordinatePredicate': { 'type': 'and', 'predicates': [{ 'type': 'equals', 'key': 'datasetKey', 'value': '38b4c89f-584c-41bb-bd8f-cd1def33e92f' }, { 'type': 'equals', 'key': 'hasCoordinate', 'value': 'true' }, { 'type': 'equals', 'key': 'hasGeospatialIssue', 'value': 'false' }] }, 'taxonPredicate': { 'type': 'and', 'predicates': [{ 'type': 'equals', 'key': 'datasetKey', 'value': '38b4c89f-584c-41bb-bd8f-cd1def33e92f' }, { 'type': 'equals', 'key': 'issue', 'value': 'TAXON_MATCH_NONE' }] }, 'eventDatePredicate': { 'type': 'and', 'predicates': [{ 'type': 'equals', 'key': 'datasetKey', 'value': '38b4c89f-584c-41bb-bd8f-cd1def33e92f' }, { 'type': 'isNotNull', 'key': 'eventDate' }] }, 'eventPredicate': { 'type': 'and', 'predicates': [{ 'type': 'equals', 'key': 'datasetKey', 'value': '38b4c89f-584c-41bb-bd8f-cd1def33e92f' }, { 'type': 'isNotNull', 'key': 'eventId' }] } }, 'operationName': 'DatasetInsights' },
  stats: { 'query': '\n  query DatasetOccurrenceSearch(\n    $from: Int\n    $size: Int\n    $predicate: Predicate\n    $imagePredicate: Predicate\n    $coordinatePredicate: Predicate\n    $clusterPredicate: Predicate\n    $eventPredicate: Predicate\n    $literaturePredicate: Predicate\n  ) {\n    occurrenceSearch(predicate: $predicate) {\n      documents(from: $from, size: $size) {\n        from\n        size\n        total\n        results {\n          dynamicProperties\n        }\n      }\n    }\n    withImages: occurrenceSearch(predicate: $imagePredicate) {\n      documents(size: 0) {\n        total\n      }\n    }\n    withCoordinates: occurrenceSearch(predicate: $coordinatePredicate) {\n      documents(size: 0) {\n        total\n      }\n    }\n    withClusters: occurrenceSearch(predicate: $clusterPredicate) {\n      documents(size: 0) {\n        total\n      }\n    }\n    withEvents: occurrenceSearch(predicate: $eventPredicate) {\n      documents(size: 0) {\n        total\n      }\n    }\n    literatureSearchScoped: literatureSearch(predicate: $literaturePredicate) {\n      documents {\n        total\n      }\n    }\n  }\n', 'variables': { 'predicate': { 'type': 'equals', 'key': 'datasetKey', 'value': '38b4c89f-584c-41bb-bd8f-cd1def33e92f' }, 'imagePredicate': { 'type': 'and', 'predicates': [{ 'type': 'equals', 'key': 'datasetKey', 'value': '38b4c89f-584c-41bb-bd8f-cd1def33e92f' }, { 'type': 'equals', 'key': 'mediaType', 'value': 'StillImage' }] }, 'coordinatePredicate': { 'type': 'and', 'predicates': [{ 'type': 'equals', 'key': 'datasetKey', 'value': '38b4c89f-584c-41bb-bd8f-cd1def33e92f' }, { 'type': 'equals', 'key': 'hasCoordinate', 'value': 'true' }] }, 'clusterPredicate': { 'type': 'and', 'predicates': [{ 'type': 'equals', 'key': 'datasetKey', 'value': '38b4c89f-584c-41bb-bd8f-cd1def33e92f' }, { 'type': 'equals', 'key': 'isInCluster', 'value': 'true' }] }, 'eventPredicate': { 'type': 'and', 'predicates': [{ 'type': 'equals', 'key': 'datasetKey', 'value': '38b4c89f-584c-41bb-bd8f-cd1def33e92f' }, { 'type': 'isNotNull', 'key': 'eventId' }] }, 'literaturePredicate': { 'type': 'equals', 'key': 'gbifDatasetKey', 'value': '38b4c89f-584c-41bb-bd8f-cd1def33e92f' }, 'size': 1, 'from': 0 }, 'operationName': 'DatasetOccurrenceSearch' }
};

module.exports = {
  datasetKeyLoad
};
